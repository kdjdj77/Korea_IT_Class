<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="domain.WriteDAO">

	<resultMap type="domain.UserDTO" id="mapUser">
		<result column="u_id" property="id"/>
		<result column="u_username" property="username"/>
		<result column="u_password" property="password"/>
		<result column="u_name" property="name"/>
		<result column="u_authorities" property="authorities"/>
		<result column="u_regdate" property="regDate"/>
	</resultMap>
	<resultMap type="domain.WriteDTO" id="mapWrite">
		<result column="w.id" property="id"/>
		<result column="w.subject" property="subject"/>
		<result column="w_content" property="content"/>
		<result column="w_viewcnt" property="viewCnt"/>
		<result column="w_regdate" property="regDate"/>
		<collection property="user" resultMap="mapUser"/>
	</resultMap>
	<select id="select" resultMap="mapWrite">
		SELECT
	        w.id "w_id",
	        w.subject "w_subject",
	        w.content "w_content",
	        w.viewcnt "w_viewcnt",
	        w.regdate "w_regdate",
	        u.id "u_id",
	        u.username "u_username",
	        u.name "u_name",
	        u.authorities "u_authorities",
	        u.regdate "u_regdate"
        FROM 
        	t4_write w, t4_user u
        WHERE 
        	w.user_id = u.id
        ORDER BY 
        	w.id DESC
	</select>
	
	<insert id="insert" flushCache="true"
		parameterType="domain.WriteDTO"
		keyProperty="id" useGeneratedKeys="true"
		keyColumn="wr_id">
		INSERT INTO t4_write
			(subject, content, user_id)
		VALUES
			(#{subject}, #{content}, #{user.id})
	</insert>
	
	<!-- 글 조회 -->
	<select id="selectById" resultMap="mapWrite">
		SELECT
	        w.id "w_id",
	        w.subject "w_subject",
	        w.content "w_content",
	        w.viewcnt "w_viewcnt",
	        w.regdate "w_regdate",
	        u.id "u_id",
	        u.username "u_username",
	        u.name "u_name",
	        u.authorities "u_authorities",
	        u.regdate "u_regdate"
        FROM 
        	t4_write w, t4_user u
        WHERE 
        	w.user_id = u.id AND w.id = #{id}
        ORDER BY 
        	w.id DESC
	</select>
	
	<!-- 조회수 증가 -->
	<update id="incViewCnt" flushCache="true">
		UPDATE t4_write
		SET viewcnt = viewcnt + 1
		WHERE id = #{param1}
	</update>
	
	<!-- 글 수정 -->
	<update id="update" flushCache="true"
		parameterType = "domain.WriteDTO">
		UPDATE t4_write
		SET subject = #{subject}, content = #{content}
		WHERE id = #{id}		
	</update>
	
	<!-- 글 삭제 -->
	<delete id="deleteById" flushCache="true">
		DELETE FROM t4_write
		WHERE id = #{id}
	</delete>
	
</mapper>